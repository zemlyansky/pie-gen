<?php

// Generated by Haxe 3.4.4
class PieChartGen {
	public function __construct(){}
	static $SIZE = 300;
	static $RADIUS = 130;
	static function normalizeValues($values) {
		$sum = 0;
		{
			$_g = 0;
			while($_g < $values->length) {
				$v = $values[$_g];
				$_g = $_g + 1;
				$sum = $sum + $v;
				unset($v);
			}
		}
		return $values->map(array(new _hx_lambda(array(&$sum), "PieChartGen_0"), 'execute'));
	}
	static function calculateArcs($values) {
		$a = 100;
		$ds = (new _hx_array(array()));
		$oldX = 150. + 130 * Math::cos(Math::$PI / 2);
		$oldY = 150. - 130 * Math::sin(Math::$PI / 2);
		$totalAngle = 0;
		{
			$_g = 0;
			while($_g < $values->length) {
				$v = $values[$_g];
				$_g = $_g + 1;
				$angle = 2 * Math::$PI * $v / 100;
				$totalAngle = $totalAngle + $angle;
				$newX = 150. + 130 * Math::cos($totalAngle - Math::$PI / 2);
				$newY = 150. + 130 * Math::sin($totalAngle - Math::$PI / 2);
				$tmp = null;
				if($angle < Math::$PI) {
					$tmp = 0;
				} else {
					$tmp = 1;
				}
				$ds->push("M " . _hx_string_rec($oldX, "") . " " . _hx_string_rec($oldY, "") . " A " . _hx_string_rec(130, "") . " " . _hx_string_rec(130, "") . " 0 " . _hx_string_rec($tmp, "") . " 1 " . _hx_string_rec($newX, "") . " " . _hx_string_rec($newY, "") . " L " . _hx_string_rec(150., "") . " " . _hx_string_rec(150., "") . " Z");
				$oldX = $newX;
				$oldY = $newY;
				unset($v,$tmp,$newY,$newX,$angle);
			}
		}
		return $ds;
	}
	static function calculateMiddlePoints($values, $innerRadiusSize) {
		$ps = (new _hx_array(array()));
		$totalAngle = 0;
		{
			$_g = 0;
			while($_g < $values->length) {
				$v = $values[$_g];
				$_g = $_g + 1;
				$angle = Math::$PI * $v / 100;
				$totalAngle = $totalAngle + $angle;
				$labelRadius = 130 * $innerRadiusSize + (130 - 130 * $innerRadiusSize) / 2;
				$newX = 150. + $labelRadius * Math::cos($totalAngle - Math::$PI / 2);
				$newY = 150. + $labelRadius * Math::sin($totalAngle - Math::$PI / 2);
				$p = _hx_anonymous(array("x" => $newX, "y" => $newY));
				$ps->push($p);
				$totalAngle = $totalAngle + $angle;
				unset($v,$p,$newY,$newX,$labelRadius,$angle);
			}
		}
		return $ps;
	}
	static function hexToTriad($hex) {
		$cleanHex = _hx_index_of($hex, "#", null) + 1;
		$cleanHex1 = _hx_explode("", _hx_substring($hex, $cleanHex, strlen($hex)));
		$color = Std::parseInt("0x" . _hx_string_or_null($cleanHex1[0]) . _hx_string_or_null($cleanHex1[1]));
		$color1 = Std::parseInt("0x" . _hx_string_or_null($cleanHex1[2]) . _hx_string_or_null($cleanHex1[3]));
		$color2 = _hx_anonymous(array("r" => $color, "g" => $color1, "b" => Std::parseInt("0x" . _hx_string_or_null($cleanHex1[4]) . _hx_string_or_null($cleanHex1[5]))));
		return $color2;
	}
	static function calculateOneColor($c1, $c2, $shift) {
		return Std::int($c1 + ($c2 - $c1) * $shift);
	}
	static function calculateColors($baseColors, $valuesLength) {
		$rgbColors = $baseColors->map(array(new _hx_lambda(array(), "PieChartGen_1"), 'execute'));
		$newColors = (new _hx_array(array()));
		{
			$_g1 = 0;
			$_g = $valuesLength;
			while($_g1 < $_g) {
				$_g1 = $_g1 + 1;
				$i = $_g1 - 1;
				$colorPair = $i * ($baseColors->length - 1) / ($valuesLength - 1);
				$colorPairNumber = Math::floor($colorPair);
				$colorPairShift = $colorPair - $colorPairNumber;
				$color = null;
				if($colorPairNumber === $baseColors->length - 1) {
					$color = $rgbColors[$colorPairNumber];
				} else {
					$color1 = PieChartGen::calculateOneColor(_hx_array_get($rgbColors, $colorPairNumber)->r, _hx_array_get($rgbColors, $colorPairNumber + 1)->r, $colorPairShift);
					$color2 = PieChartGen::calculateOneColor(_hx_array_get($rgbColors, $colorPairNumber)->g, _hx_array_get($rgbColors, $colorPairNumber + 1)->g, $colorPairShift);
					$color = _hx_anonymous(array("r" => $color1, "g" => $color2, "b" => PieChartGen::calculateOneColor(_hx_array_get($rgbColors, $colorPairNumber)->b, _hx_array_get($rgbColors, $colorPairNumber + 1)->b, $colorPairShift)));
					unset($color2,$color1);
				}
				$newColors->push($color);
				unset($i,$colorPairShift,$colorPairNumber,$colorPair,$color);
			}
		}
		return $newColors;
	}
	static function create($values, $params) {
		$values = new _hx_array($values);
		$paramsMap = php_Lib::hashOfAssociativeArray($params);
		$newParams = _hx_anonymous(array());
		{
			$key = $paramsMap->keys();
			while($key->hasNext()) {
				$key1 = $key->next();
				$value = $paramsMap->get($key1);
				if($key1 === "colors") {
					$value = new _hx_array($value);
				}
				$newParams->{$key1} = $value;
				unset($value,$key1);
			}
		}
		$params = $newParams;
		$mask = "\x0A      <mask id=\"donut-mask\">\x0A        <rect width=\"100%\" height=\"100%\" fill=\"white\"></rect>\x0A        <circle r=\"" . _hx_string_rec(130 * _hx_field($params, "innerRadiusSize"), "") . "\" cx=\"" . _hx_string_rec(150., "") . "\" cy=\"" . _hx_string_rec(150., "") . "\" fill=\"black\"></circle>\x0A      </mask>\x0A    ";
		$groups = "";
		$ds = PieChartGen::calculateArcs(PieChartGen::normalizeValues($values));
		$ps = PieChartGen::normalizeValues($values);
		$ps1 = PieChartGen::calculateMiddlePoints($ps, _hx_field($params, "innerRadiusSize"));
		$cs = PieChartGen::calculateColors(_hx_field($params, "colors"), _hx_field($values, "length"));
		{
			$_g1 = 0;
			$_g = _hx_field($values, "length");
			while($_g1 < $_g) {
				$_g1 = $_g1 + 1;
				$i = $_g1 - 1;
				$g = "\x0A        <g>\x0A          <path mask=\"url(#donut-mask)\" fill=\"rgb(" . _hx_string_rec(_hx_array_get($cs, $i)->r, "") . ", " . _hx_string_rec(_hx_array_get($cs, $i)->g, "") . ", " . _hx_string_rec(_hx_array_get($cs, $i)->b, "") . ")\" stroke=\"rgb(" . _hx_string_rec(_hx_array_get($cs, $i)->r, "") . ", " . _hx_string_rec(_hx_array_get($cs, $i)->g, "") . ", " . _hx_string_rec(_hx_array_get($cs, $i)->b, "") . ")\" d=\"" . _hx_string_or_null($ds[$i]) . "\"></path>\x0A          <text fill=\"white\" stroke=\"none\" text-anchor=\"middle\" font-size=\"10px\" font-family=\"sans-serif\" x=\"" . _hx_string_rec(_hx_array_get($ps1, $i)->x, "") . "\" y=\"" . _hx_string_rec((_hx_array_get($ps1, $i)->y + 5), "") . "\">" . _hx_string_or_null($values[$i]) . "</text>\x0A        </g>\x0A      ";
				$groups = _hx_string_or_null($groups) . _hx_string_or_null($g);
				unset($i,$g);
			}
		}
		$output = "\x0A      <svg viewBox=\"0 0 " . _hx_string_rec(300, "") . " " . _hx_string_rec(300, "") . "\" preserveAspectRatio=\"xMinYMin meet\">\x0A        " . _hx_string_or_null($mask) . "\x0A        " . _hx_string_or_null($groups) . "\x0A      </svg>\x0A    ";
		return $output;
	}
	function __toString() { return 'PieChartGen'; }
}
function PieChartGen_0(&$sum, $v1) {
	{
		return $v1 * 100 / $sum;
	}
}
function PieChartGen_1($c) {
	{
		return PieChartGen::hexToTriad($c);
	}
}
